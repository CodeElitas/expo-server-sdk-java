plugins {
  id 'java-library'
  id 'maven-publish'
  id 'signing'
}

ext {
  commonsLangVersion = '3.12.0'
  jacksonVersion = '2.13.4'
  junitVersion = '5.8.2'
}

group = 'com.niamedtech.expo'

repositories {
  mavenCentral()
}

dependencies {
  implementation "com.fasterxml.jackson.core:jackson-databind:${jacksonVersion}"
  implementation "com.fasterxml.jackson.core:jackson-core:${jacksonVersion}"
  implementation "org.apache.commons:commons-lang3:${commonsLangVersion}"
  
  testImplementation "org.junit.jupiter:junit-jupiter-api:${junitVersion}"
  testImplementation 'org.mockito:mockito-core:3.3.3'
  
  testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:${junitVersion}"
}

test {
  useJUnitPlatform()
}

task javadocJar(type: Jar) {
  classifier = 'javadoc'
  from javadoc
}

task sourcesJar(type: Jar) {
  classifier = 'sources'
  from sourceSets.main.allSource
}

artifacts {
  archives javadocJar, sourcesJar
}

signing {
  sign configurations.archives
}

publishing {
  repositories {
    maven {
      name = "OSSRH"
      url = version.toString().endsWith('-SNAPSHOT') ? 'https://s01.oss.sonatype.org/content/repositories' : 'https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/'
      credentials {
        username = System.getenv("MAVEN_USERNAME")
        password = System.getenv("MAVEN_PASSWORD")
      }
    }
  }
  
  publications {
    mavenJava(MavenPublication) {
      pom {
        name = 'expo-server-sdk'
        description = 'Java implementation of expo-server-sdk implementation.Classes and methods to manage push notifications'
        url = 'https://github.com/nia-medtech/expo-server-sdk-java'
 
        licenses {
            license {
                name = 'The MIT License'
                url = 'https://raw.githubusercontent.com/nia-medtech/expo-server-sdk-java/edit/main/LICENCE.txt'
            }
        }
        developers {
            developer {
                id = 'oliverwelter'
                name = 'Oliver Welter'
                email = 'oliver.welter@nia-medtech.com'
            }
        }
        scm {
            connection = 'scm:git:git@github.com:nia-medtech/expo-server-sdk-java.git'
            developerConnection = 'scm:git:git@github.com:nia-medtech/expo-server-sdk-java.git'
            url = 'scm:git:git@github.com:nia-medtech/expo-server-sdk-java.git'
          }
      }
    }
  }
}